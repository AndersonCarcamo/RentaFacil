# Configuración Redis para EasyRent Media Cache
# Archivo: redis/redis.conf

# =====================================
# CONFIGURACIÓN BÁSICA
# =====================================

# Puerto de escucha
port 6379

# Bind a todas las interfaces (para Docker)
bind 0.0.0.0

# Timeout para conexiones inactivas (0 = sin timeout)
timeout 300

# TCP keepalive
tcp-keepalive 300

# =====================================
# CONFIGURACIÓN DE MEMORIA
# =====================================

# Política de eliminación cuando se llena la memoria
maxmemory-policy allkeys-lru

# Máximo de memoria (ajustar según necesidades)
# maxmemory 512mb

# Samples para algoritmo LRU
maxmemory-samples 5

# =====================================
# CONFIGURACIÓN DE PERSISTENCIA
# =====================================

# Guardar snapshot automáticamente
save 900 1      # Si hay al menos 1 cambio en 900 segundos
save 300 10     # Si hay al menos 10 cambios en 300 segundos  
save 60 10000   # Si hay al menos 10000 cambios en 60 segundos

# Detener escrituras si falla el guardado
stop-writes-on-bgsave-error yes

# Comprimir snapshots
rdbcompression yes

# Verificar checksum de RDB
rdbchecksum yes

# Nombre del archivo RDB
dbfilename dump.rdb

# Directorio para archivos de persistencia
dir /data

# =====================================
# LOGGING
# =====================================

# Nivel de log: debug, verbose, notice, warning
loglevel notice

# Log file (vacío = stdout)
logfile ""

# =====================================
# CONFIGURACIÓN DE CLIENTE
# =====================================

# Máximo de conexiones de clientes
maxclients 10000

# =====================================
# CONFIGURACIÓN AVANZADA
# =====================================

# Activar lazy freeing para mejor performance
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes

# Configuración de hash table
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# Configuración de listas
list-max-ziplist-size -2
list-compress-depth 0

# Configuración de sets
set-max-intset-entries 512

# Configuración de sorted sets
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# =====================================
# CONFIGURACIÓN DE SLOW LOG
# =====================================

# Log de consultas lentas (en microsegundos)
slowlog-log-slower-than 10000

# Máximo de entradas en slow log
slowlog-max-len 128

# =====================================
# CONFIGURACIÓN DE NOTIFICACIONES
# =====================================

# Notificaciones de eventos de keyspace
notify-keyspace-events ""

# =====================================
# CONFIGURACIÓN DE CLUSTERING (DESHABILITADO)
# =====================================

# cluster-enabled no

# =====================================
# CONFIGURACIÓN DE SEGURIDAD BÁSICA
# =====================================

# Deshabilitar comandos peligrosos (descomentaryar si es necesario)
# rename-command FLUSHDB ""
# rename-command FLUSHALL ""
# rename-command KEYS ""
# rename-command CONFIG ""
# rename-command SHUTDOWN ""
# rename-command DEBUG ""
# rename-command EVAL ""

# Contraseña para AUTH (configurar en producción)
# requirepass your-redis-password-here

# =====================================
# MÓDULOS (SI SE NECESITAN)
# =====================================

# loadmodule /path/to/redis-module.so